68K GAS   			page 1


   1               	
   2               	.file"fopen.c"
   3               	.text
   4               	.align2
   5               	.globl_basefopen
   7               	_basefopen:
   8 0000 4E56 FFE0 	link.w %fp,#-32
   9 0004 2F02      	move.l %d2,-(%sp)
  10 0006 42AE FFFC 	clr.l -4(%fp)
  11 000a 42AE FFF8 	clr.l -8(%fp)
  12 000e 42AE FFF4 	clr.l -12(%fp)
  13 0012 42AE FFF0 	clr.l -16(%fp)
  14 0016 2039 0000 	move.l maxfiles,%d0
  14      0000 
  15 001c 7214      	moveq #20,%d1
  16 001e B280      	cmp.l %d0,%d1
  17 0020 6606      	jne .L2
  18 0022 4280      	clr.l %d0
  19 0024 6000 0316 	jra .L3
  20               	.L2:
  21 0028 42AE FFEC 	clr.l -20(%fp)
  22 002c 607A      	jra .L4
  23               	.L14:
  24 002e 202E FFEC 	move.l -20(%fp),%d0
  25 0032 D0AE 000C 	add.l 12(%fp),%d0
  26 0036 2040      	move.l %d0,%a0
  27 0038 1010      	move.b (%a0),%d0
  28 003a 49C0      	extb.l %d0
  29 003c 7272      	moveq #114,%d1
  30 003e B280      	cmp.l %d0,%d1
  31 0040 6728      	jeq .L9
  32 0042 7272      	moveq #114,%d1
  33 0044 B280      	cmp.l %d0,%d1
  34 0046 6D14      	jlt .L12
  35 0048 7261      	moveq #97,%d1
  36 004a B280      	cmp.l %d0,%d1
  37 004c 672C      	jeq .L7
  38 004e 7262      	moveq #98,%d1
  39 0050 B280      	cmp.l %d0,%d1
  40 0052 673C      	jeq .L8
  41 0054 722B      	moveq #43,%d1
  42 0056 B280      	cmp.l %d0,%d1
  43 0058 672E      	jeq .L6
  44 005a 6042      	jra .L5
  45               	.L12:
  46 005c 7274      	moveq #116,%d1
  47 005e B280      	cmp.l %d0,%d1
  48 0060 6736      	jeq .L10
  49 0062 7277      	moveq #119,%d1
  50 0064 B280      	cmp.l %d0,%d1
  51 0066 670A      	jeq .L11
  52 0068 6034      	jra .L5
  53               	.L9:
  54 006a 7001      	moveq #1,%d0
  55 006c 81AE FFFC 	or.l %d0,-4(%fp)
  56 0070 6032      	jra .L13
  57               	.L11:
68K GAS   			page 2


  58 0072 7202      	moveq #2,%d1
  59 0074 83AE FFFC 	or.l %d1,-4(%fp)
  60 0078 602A      	jra .L13
  61               	.L7:
  62 007a 7002      	moveq #2,%d0
  63 007c 81AE FFFC 	or.l %d0,-4(%fp)
  64 0080 7201      	moveq #1,%d1
  65 0082 2D41 FFF8 	move.l %d1,-8(%fp)
  66 0086 601C      	jra .L13
  67               	.L6:
  68 0088 7001      	moveq #1,%d0
  69 008a 2D40 FFF4 	move.l %d0,-12(%fp)
  70 008e 6014      	jra .L13
  71               	.L8:
  72 0090 7240      	moveq #64,%d1
  73 0092 83AE FFFC 	or.l %d1,-4(%fp)
  74 0096 600C      	jra .L13
  75               	.L10:
  76 0098 70BF      	moveq #-65,%d0
  77 009a C1AE FFFC 	and.l %d0,-4(%fp)
  78               	.L5:
  79 009e 4280      	clr.l %d0
  80 00a0 6000 029A 	jra .L3
  81               	.L13:
  82 00a4 52AE FFEC 	addq.l #1,-20(%fp)
  83               	.L4:
  84 00a8 242E FFEC 	move.l -20(%fp),%d2
  85 00ac 2F2E 000C 	move.l 12(%fp),-(%sp)
  86 00b0 4EB9 0000 	jsr strlen
  86      0000 
  87 00b6 588F      	addq.l #4,%sp
  88 00b8 B082      	cmp.l %d2,%d0
  89 00ba 6200 FF72 	jhi .L14
  90 00be 7003      	moveq #3,%d0
  91 00c0 C0AE FFFC 	and.l -4(%fp),%d0
  92 00c4 4A80      	tst.l %d0
  93 00c6 6606      	jne .L15
  94 00c8 4280      	clr.l %d0
  95 00ca 6000 0270 	jra .L3
  96               	.L15:
  97 00ce 2F2E 0008 	move.l 8(%fp),-(%sp)
  98 00d2 4EB9 0000 	jsr strlen
  98      0000 
  99 00d8 588F      	addq.l #4,%sp
 100 00da 5280      	addq.l #1,%d0
 101 00dc 2F00      	move.l %d0,-(%sp)
 102 00de 4EB9 0000 	jsr malloc
 102      0000 
 103 00e4 588F      	addq.l #4,%sp
 104 00e6 2008      	move.l %a0,%d0
 105 00e8 2D40 FFE4 	move.l %d0,-28(%fp)
 106 00ec 4AAE FFE4 	tst.l -28(%fp)
 107 00f0 6606      	jne .L16
 108 00f2 4280      	clr.l %d0
 109 00f4 6000 0246 	jra .L3
 110               	.L16:
 111 00f8 2F2E 0008 	move.l 8(%fp),-(%sp)
68K GAS   			page 3


 112 00fc 2F2E FFE4 	move.l -28(%fp),-(%sp)
 113 0100 4EB9 0000 	jsr strcpy
 113      0000 
 114 0106 508F      	addq.l #8,%sp
 115 0108 4AAE 0010 	tst.l 16(%fp)
 116 010c 6708      	jeq .L17
 117 010e 2D6E 0010 	move.l 16(%fp),-24(%fp)
 117      FFE8 
 118 0114 603E      	jra .L18
 119               	.L17:
 120 0116 4878 001C 	pea 28.w
 121 011a 4EB9 0000 	jsr malloc
 121      0000 
 122 0120 588F      	addq.l #4,%sp
 123 0122 2008      	move.l %a0,%d0
 124 0124 2D40 FFE8 	move.l %d0,-24(%fp)
 125 0128 4AAE FFE8 	tst.l -24(%fp)
 126 012c 6612      	jne .L19
 127 012e 2F2E FFE4 	move.l -28(%fp),-(%sp)
 128 0132 4EB9 0000 	jsr free
 128      0000 
 129 0138 588F      	addq.l #4,%sp
 130 013a 4280      	clr.l %d0
 131 013c 6000 01FE 	jra .L3
 132               	.L19:
 133 0140 4878 001C 	pea 28.w
 134 0144 42A7      	clr.l -(%sp)
 135 0146 2F2E FFE8 	move.l -24(%fp),-(%sp)
 136 014a 4EB9 0000 	jsr memset
 136      0000 
 137 0150 4FEF 000C 	lea (12,%sp),%sp
 138               	.L18:
 139 0154 202E FFE8 	move.l -24(%fp),%d0
 140 0158 2040      	move.l %d0,%a0
 141 015a 42A8 0004 	clr.l 4(%a0)
 142 015e 4878 0200 	pea 512.w
 143 0162 4EB9 0000 	jsr malloc
 143      0000 
 144 0168 588F      	addq.l #4,%sp
 145 016a 2008      	move.l %a0,%d0
 146 016c 2D40 FFE0 	move.l %d0,-32(%fp)
 147 0170 4AAE FFE0 	tst.l -32(%fp)
 148 0174 661E      	jne .L20
 149 0176 2F2E FFE4 	move.l -28(%fp),-(%sp)
 150 017a 4EB9 0000 	jsr free
 150      0000 
 151 0180 588F      	addq.l #4,%sp
 152 0182 2F2E FFE8 	move.l -24(%fp),-(%sp)
 153 0186 4EB9 0000 	jsr free
 153      0000 
 154 018c 588F      	addq.l #4,%sp
 155 018e 4280      	clr.l %d0
 156 0190 6000 01AA 	jra .L3
 157               	.L20:
 158 0194 7003      	moveq #3,%d0
 159 0196 C0AE FFFC 	and.l -4(%fp),%d0
 160 019a 7201      	moveq #1,%d1
68K GAS   			page 4


 161 019c B280      	cmp.l %d0,%d1
 162 019e 671C      	jeq .L23
 163 01a0 7201      	moveq #1,%d1
 164 01a2 B280      	cmp.l %d0,%d1
 165 01a4 6D08      	jlt .L26
 166 01a6 4A80      	tst.l %d0
 167 01a8 6700 0130 	jeq .L34
 168 01ac 606C      	jra .L21
 169               	.L26:
 170 01ae 7202      	moveq #2,%d1
 171 01b0 B280      	cmp.l %d0,%d1
 172 01b2 6734      	jeq .L24
 173 01b4 7203      	moveq #3,%d1
 174 01b6 B280      	cmp.l %d0,%d1
 175 01b8 675A      	jeq .L25
 176 01ba 605E      	jra .L21
 177               	.L23:
 178 01bc 4AAE FFF4 	tst.l -12(%fp)
 179 01c0 6706      	jeq .L28
 180 01c2 7002      	moveq #2,%d0
 181 01c4 81AE FFFC 	or.l %d0,-4(%fp)
 182               	.L28:
 183 01c8 2F2E FFFC 	move.l -4(%fp),-(%sp)
 184 01cc 4EB9 0000 	jsr _ll_flags
 184      0000 
 185 01d2 588F      	addq.l #4,%sp
 186 01d4 2F00      	move.l %d0,-(%sp)
 187 01d6 2F2E 0008 	move.l 8(%fp),-(%sp)
 188 01da 4EB9 0000 	jsr _ll_open
 188      0000 
 189 01e0 508F      	addq.l #8,%sp
 190 01e2 2D40 FFF0 	move.l %d0,-16(%fp)
 191 01e6 6032      	jra .L21
 192               	.L24:
 193 01e8 4AAE FFF4 	tst.l -12(%fp)
 194 01ec 6706      	jeq .L29
 195 01ee 7201      	moveq #1,%d1
 196 01f0 83AE FFFC 	or.l %d1,-4(%fp)
 197               	.L29:
 198 01f4 2F2E FFFC 	move.l -4(%fp),-(%sp)
 199 01f8 4EB9 0000 	jsr _ll_flags
 199      0000 
 200 01fe 588F      	addq.l #4,%sp
 201 0200 2F00      	move.l %d0,-(%sp)
 202 0202 2F2E 0008 	move.l 8(%fp),-(%sp)
 203 0206 4EB9 0000 	jsr _ll_creat
 203      0000 
 204 020c 508F      	addq.l #8,%sp
 205 020e 2D40 FFF0 	move.l %d0,-16(%fp)
 206 0212 6006      	jra .L21
 207               	.L25:
 208 0214 4280      	clr.l %d0
 209 0216 6000 0124 	jra .L3
 210               	.L21:
 211 021a 4AAE FFF0 	tst.l -16(%fp)
 212 021e 6700 00BE 	jeq .L35
 213               	.L30:
68K GAS   			page 5


 214 0222 202E FFE8 	move.l -24(%fp),%d0
 215 0226 2040      	move.l %d0,%a0
 216 0228 317C 444C 	move.w #17484,26(%a0)
 216      001A 
 217 022e 202E FFE8 	move.l -24(%fp),%d0
 218 0232 2040      	move.l %d0,%a0
 219 0234 4290      	clr.l (%a0)
 220 0236 202E FFF0 	move.l -16(%fp),%d0
 221 023a 1200      	move.b %d0,%d1
 222 023c 202E FFE8 	move.l -24(%fp),%d0
 223 0240 2040      	move.l %d0,%a0
 224 0242 1141 0008 	move.b %d1,8(%a0)
 225 0246 202E FFE8 	move.l -24(%fp),%d0
 226 024a 2040      	move.l %d0,%a0
 227 024c 2228 0004 	move.l 4(%a0),%d1
 228 0250 202E FFFC 	move.l -4(%fp),%d0
 229 0254 8280      	or.l %d0,%d1
 230 0256 202E FFE8 	move.l -24(%fp),%d0
 231 025a 2040      	move.l %d0,%a0
 232 025c 2141 0004 	move.l %d1,4(%a0)
 233 0260 202E FFE8 	move.l -24(%fp),%d0
 234 0264 2040      	move.l %d0,%a0
 235 0266 42A8 0016 	clr.l 22(%a0)
 236 026a 202E FFE8 	move.l -24(%fp),%d0
 237 026e 2040      	move.l %d0,%a0
 238 0270 4228 0009 	clr.b 9(%a0)
 239 0274 7040      	moveq #64,%d0
 240 0276 C0AE FFFC 	and.l -4(%fp),%d0
 241 027a 4A80      	tst.l %d0
 242 027c 671C      	jeq .L31
 243 027e 4878 0200 	pea 512.w
 244 0282 4878 0001 	pea 1.w
 245 0286 2F2E FFE0 	move.l -32(%fp),-(%sp)
 246 028a 2F2E FFE8 	move.l -24(%fp),-(%sp)
 247 028e 4EB9 0000 	jsr setvbuf
 247      0000 
 248 0294 4FEF 0010 	lea (16,%sp),%sp
 249 0298 601A      	jra .L32
 250               	.L31:
 251 029a 4878 0200 	pea 512.w
 252 029e 4878 0002 	pea 2.w
 253 02a2 2F2E FFE0 	move.l -32(%fp),-(%sp)
 254 02a6 2F2E FFE8 	move.l -24(%fp),-(%sp)
 255 02aa 4EB9 0000 	jsr setvbuf
 255      0000 
 256 02b0 4FEF 0010 	lea (16,%sp),%sp
 257               	.L32:
 258 02b4 7004      	moveq #4,%d0
 259 02b6 81AE FFFC 	or.l %d0,-4(%fp)
 260 02ba 4AAE FFF8 	tst.l -8(%fp)
 261 02be 6750      	jeq .L33
 262 02c0 4878 0002 	pea 2.w
 263 02c4 42A7      	clr.l -(%sp)
 264 02c6 2F2E FFE8 	move.l -24(%fp),-(%sp)
 265 02ca 4EB9 0000 	jsr fseek
 265      0000 
 266 02d0 4FEF 000C 	lea (12,%sp),%sp
68K GAS   			page 6


 267 02d4 4A80      	tst.l %d0
 268 02d6 6738      	jeq .L33
 269 02d8 6006      	jra .L27
 270               	.L34:
 271 02da 4E71      	nop
 272 02dc 6002      	jra .L27
 273               	.L35:
 274 02de 4E71      	nop
 275               	.L27:
 276 02e0 2F2E FFE4 	move.l -28(%fp),-(%sp)
 277 02e4 4EB9 0000 	jsr free
 277      0000 
 278 02ea 588F      	addq.l #4,%sp
 279 02ec 202E FFE8 	move.l -24(%fp),%d0
 280 02f0 2040      	move.l %d0,%a0
 281 02f2 2028 000E 	move.l 14(%a0),%d0
 282 02f6 2F00      	move.l %d0,-(%sp)
 283 02f8 4EB9 0000 	jsr free
 283      0000 
 284 02fe 588F      	addq.l #4,%sp
 285 0300 2F2E FFE8 	move.l -24(%fp),-(%sp)
 286 0304 4EB9 0000 	jsr free
 286      0000 
 287 030a 588F      	addq.l #4,%sp
 288 030c 4280      	clr.l %d0
 289 030e 602C      	jra .L3
 290               	.L33:
 291 0310 2039 0000 	move.l maxfiles,%d0
 291      0000 
 292 0316 21AE FFE4 	move.l -28(%fp),_filenames(%d0.l*4)
 292      0DB0 0000 
 292      0000 
 293 0320 2039 0000 	move.l maxfiles,%d0
 293      0000 
 294 0326 21AE FFE8 	move.l -24(%fp),_pstreams(%d0.l*4)
 294      0DB0 0000 
 294      0000 
 295 0330 5280      	addq.l #1,%d0
 296 0332 23C0 0000 	move.l %d0,maxfiles
 296      0000 
 297 0338 202E FFE8 	move.l -24(%fp),%d0
 298               	.L3:
 299 033c 2200      	move.l %d0,%d1
 300 033e 2041      	move.l %d1,%a0
 301 0340 242E FFDC 	move.l -36(%fp),%d2
 302 0344 4E5E      	unlk %fp
 303 0346 4E75      	rts
 305               	.align2
 306               	.globlfopen
 308               	fopen:
 309 0348 4E56 0000 	link.w %fp,#0
 310 034c 42A7      	clr.l -(%sp)
 311 034e 2F2E 000C 	move.l 12(%fp),-(%sp)
 312 0352 2F2E 0008 	move.l 8(%fp),-(%sp)
 313 0356 4EBA FCA8 	jsr _basefopen
 314 035a 4FEF 000C 	lea (12,%sp),%sp
 315 035e 2008      	move.l %a0,%d0
68K GAS   			page 7


 316 0360 2200      	move.l %d0,%d1
 317 0362 2041      	move.l %d1,%a0
 318 0364 4E5E      	unlk %fp
 319 0366 4E75      	rts
 321               	.ident"GCC: (GNU) 4.5.1"
 322               	.section.note.GNU-stack,"",@progbits
68K GAS   			page 8


DEFINED SYMBOLS
                            *ABS*:00000000 fopen.c
    {standard input}:7      .text:00000000 _basefopen
    {standard input}:308    .text:00000348 fopen

UNDEFINED SYMBOLS
maxfiles
strlen
malloc
strcpy
free
memset
_ll_flags
_ll_open
_ll_creat
setvbuf
fseek
_filenames
_pstreams
