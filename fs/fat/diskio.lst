68K GAS   			page 1


   1               	
   2               	.file"diskio.c"
   3               	.globlusNumHeads
   4               	.section.bss
   5               	.align2
   8               	usNumHeads:
   9 0000 0000      	.zero2
  10               	.globlusNumSecs
  11               	.align2
  14               	usNumSecs:
  15 0002 0000      	.zero2
  16               	.localStat
  17               	.commStat,80,2
  18               	.localBuffer
  19               	.commBuffer,512,1
  20               	.localstat
  21               	.commstat,8,2
  22               	.text
  23               	.align2
  24               	.globlinit_ff
  26               	init_ff:
  27 0000 4E56 0000 	link.w %fp,#0
  28 0004 4878 0050 	pea 80.w
  29 0008 4878 0001 	pea 1.w
  30 000c 4879 0000 	pea Stat
  30      0000 
  31 0012 4EB9 0000 	jsr memset
  31      0000 
  32 0018 4FEF 000C 	lea (12,%sp),%sp
  33 001c 4878 0200 	pea 512.w
  34 0020 42A7      	clr.l -(%sp)
  35 0022 4879 0000 	pea Buffer
  35      0000 
  36 0028 4EB9 0000 	jsr memset
  36      0000 
  37 002e 4FEF 000C 	lea (12,%sp),%sp
  38 0032 4E5E      	unlk %fp
  39 0034 4E75      	rts
  41               	.align2
  42               	.globldisk_initialize
  44               	disk_initialize:
  45 0036 4E56 FDF8 	link.w %fp,#-520
  46 003a 2F02      	move.l %d2,-(%sp)
  47 003c 202E 0008 	move.l 8(%fp),%d0
  48 0040 1D40 FDFA 	move.b %d0,-518(%fp)
  49 0044 102E FDFA 	move.b -518(%fp),%d0
  50 0048 5200      	addq.b #1,%d0
  51 004a 1000      	move.b %d0,%d0
  52 004c 0280 0000 	and.l #255,%d0
  52      00FF 
  53 0052 220E      	move.l %fp,%d1
  54 0054 0681 FFFF 	add.l #-514,%d1
  54      FDFE 
  55 005a 2F01      	move.l %d1,-(%sp)
  56 005c 2F00      	move.l %d0,-(%sp)
  57 005e 4EB9 0000 	jsr idetifyIDE
  57      0000 
68K GAS   			page 2


  58 0064 508F      	addq.l #8,%sp
  59 0066 1D40 FFFF 	move.b %d0,-1(%fp)
  60 006a 422E FFFF 	clr.b -1(%fp)
  61 006e 4280      	clr.l %d0
  62 0070 102E FDFA 	move.b -518(%fp),%d0
  63 0074 4230 0FB0 	clr.b Stat(%d0.l*8)
  63      0000 0000 
  64 007c 4280      	clr.l %d0
  65 007e 102E FDFA 	move.b -518(%fp),%d0
  66 0082 31BC 0200 	move.w #512,Stat+2(%d0.l*8)
  66      0FB0 0000 
  66      0000 
  67 008c 4280      	clr.l %d0
  68 008e 102E FDFA 	move.b -518(%fp),%d0
  69 0092 322E FE00 	move.w -512(%fp),%d1
  70 0096 3201      	move.w %d1,%d1
  71 0098 0281 0000 	and.l #65535,%d1
  71      FFFF 
  72 009e 2041      	move.l %d1,%a0
  73 00a0 322E FE04 	move.w -508(%fp),%d1
  74 00a4 3201      	move.w %d1,%d1
  75 00a6 0281 0000 	and.l #65535,%d1
  75      FFFF 
  76 00ac 2408      	move.l %a0,%d2
  77 00ae 4C01 2800 	muls.l %d1,%d2
  78 00b2 2042      	move.l %d2,%a0
  79 00b4 322E FE0A 	move.w -502(%fp),%d1
  80 00b8 3201      	move.w %d1,%d1
  81 00ba 0281 0000 	and.l #65535,%d1
  81      FFFF 
  82 00c0 2408      	move.l %a0,%d2
  83 00c2 4C02 1800 	muls.l %d2,%d1
  84 00c6 2181 0FB0 	move.l %d1,Stat+4(%d0.l*8)
  84      0000 0000 
  85 00ce 4280      	clr.l %d0
  86 00d0 102E FDFA 	move.b -518(%fp),%d0
  87 00d4 1030 0FB0 	move.b Stat(%d0.l*8),%d0
  87      0000 0000 
  88 00dc 4A00      	tst.b %d0
  89 00de 6710      	jeq .L3
  90 00e0 4280      	clr.l %d0
  91 00e2 102E FDFA 	move.b -518(%fp),%d0
  92 00e6 11BC 0002 	move.b #2,Stat(%d0.l*8)
  92      0FB0 0000 
  92      0000 
  93               	.L3:
  94 00f0 4280      	clr.l %d0
  95 00f2 102E FDFA 	move.b -518(%fp),%d0
  96 00f6 1030 0FB0 	move.b Stat(%d0.l*8),%d0
  96      0000 0000 
  97 00fe 242E FDF4 	move.l -524(%fp),%d2
  98 0102 4E5E      	unlk %fp
  99 0104 4E75      	rts
 101               	.align2
 102               	.globldisk_status
 104               	disk_status:
 105 0106 4E56 FFF8 	link.w %fp,#-8
68K GAS   			page 3


 106 010a 202E 0008 	move.l 8(%fp),%d0
 107 010e 1D40 FFFA 	move.b %d0,-6(%fp)
 108 0112 4280      	clr.l %d0
 109 0114 102E FFFA 	move.b -6(%fp),%d0
 110 0118 1D70 0FB0 	move.b Stat(%d0.l*8),-1(%fp)
 110      0000 0000 
 110      FFFF 
 111 0122 102E FFFF 	move.b -1(%fp),%d0
 112 0126 4E5E      	unlk %fp
 113 0128 4E75      	rts
 115               	.align2
 116               	.globldisk_readp
 118               	disk_readp:
 119 012a 4E56 FFF4 	link.w %fp,#-12
 120 012e 222E 0010 	move.l 16(%fp),%d1
 121 0132 202E 0014 	move.l 20(%fp),%d0
 122 0136 3D41 FFF6 	move.w %d1,-10(%fp)
 123 013a 3D40 FFF4 	move.w %d0,-12(%fp)
 124 013e 4879 0000 	pea Buffer
 124      0000 
 125 0144 4878 0001 	pea 1.w
 126 0148 4878 0001 	pea 1.w
 127 014c 2F2E 000C 	move.l 12(%fp),-(%sp)
 128 0150 4878 0001 	pea 1.w
 129 0154 4EB9 0000 	jsr _ide
 129      0000 
 130 015a 4FEF 0014 	lea (20,%sp),%sp
 131 015e 2D40 FFFC 	move.l %d0,-4(%fp)
 132 0162 4280      	clr.l %d0
 133 0164 302E FFF6 	move.w -10(%fp),%d0
 134 0168 2200      	move.l %d0,%d1
 135 016a 0681 0000 	add.l #Buffer,%d1
 135      0000 
 136 0170 2D41 FFF8 	move.l %d1,-8(%fp)
 137 0174 4AAE 0008 	tst.l 8(%fp)
 138 0178 671A      	jeq .L6
 139 017a 4280      	clr.l %d0
 140 017c 302E FFF4 	move.w -12(%fp),%d0
 141 0180 2F00      	move.l %d0,-(%sp)
 142 0182 2F2E FFF8 	move.l -8(%fp),-(%sp)
 143 0186 2F2E 0008 	move.l 8(%fp),-(%sp)
 144 018a 4EB9 0000 	jsr memcpy
 144      0000 
 145 0190 4FEF 000C 	lea (12,%sp),%sp
 146               	.L6:
 147 0194 202E FFFC 	move.l -4(%fp),%d0
 148 0198 4E5E      	unlk %fp
 149 019a 4E75      	rts
 151               	.align2
 152               	.globldisk_writep
 154               	disk_writep:
 155 019c 4E56 FFFC 	link.w %fp,#-4
 156 01a0 4AAE 0008 	tst.l 8(%fp)
 157 01a4 6666      	jne .L8
 158 01a6 4AAE 000C 	tst.l 12(%fp)
 159 01aa 672C      	jeq .L9
 160 01ac 23EE 000C 	move.l 12(%fp),stat
68K GAS   			page 4


 160      0000 0000 
 161 01b4 42B9 0000 	clr.l stat+4
 161      0000 
 162 01ba 4878 0200 	pea 512.w
 163 01be 42A7      	clr.l -(%sp)
 164 01c0 4879 0000 	pea Buffer
 164      0000 
 165 01c6 4EB9 0000 	jsr memset
 165      0000 
 166 01cc 4FEF 000C 	lea (12,%sp),%sp
 167 01d0 42AE FFFC 	clr.l -4(%fp)
 168 01d4 6000 008E 	jra .L10
 169               	.L9:
 170 01d8 2039 0000 	move.l stat,%d0
 170      0000 
 171 01de 4879 0000 	pea Buffer
 171      0000 
 172 01e4 4878 0001 	pea 1.w
 173 01e8 4878 0001 	pea 1.w
 174 01ec 2F00      	move.l %d0,-(%sp)
 175 01ee 4878 0002 	pea 2.w
 176 01f2 4EB9 0000 	jsr _ide
 176      0000 
 177 01f8 4FEF 0014 	lea (20,%sp),%sp
 178 01fc 2D40 FFFC 	move.l %d0,-4(%fp)
 179 0200 42B9 0000 	clr.l stat
 179      0000 
 180 0206 42AE FFFC 	clr.l -4(%fp)
 181 020a 6058      	jra .L10
 182               	.L8:
 183 020c 2039 0000 	move.l stat+4,%d0
 183      0000 
 184 0212 D0AE 000C 	add.l 12(%fp),%d0
 185 0216 0C80 0000 	cmp.l #512,%d0
 185      0200 
 186 021c 6312      	jls .L11
 187 021e 2039 0000 	move.l stat+4,%d0
 187      0000 
 188 0224 223C 0000 	move.l #512,%d1
 188      0200 
 189 022a 9280      	sub.l %d0,%d1
 190 022c 2D41 000C 	move.l %d1,12(%fp)
 191               	.L11:
 192 0230 2039 0000 	move.l stat+4,%d0
 192      0000 
 193 0236 0680 0000 	add.l #Buffer,%d0
 193      0000 
 194 023c 2F2E 000C 	move.l 12(%fp),-(%sp)
 195 0240 2F2E 0008 	move.l 8(%fp),-(%sp)
 196 0244 2F00      	move.l %d0,-(%sp)
 197 0246 4EB9 0000 	jsr memcpy
 197      0000 
 198 024c 4FEF 000C 	lea (12,%sp),%sp
 199 0250 2039 0000 	move.l stat+4,%d0
 199      0000 
 200 0256 D0AE 000C 	add.l 12(%fp),%d0
 201 025a 23C0 0000 	move.l %d0,stat+4
68K GAS   			page 5


 201      0000 
 202 0260 42AE FFFC 	clr.l -4(%fp)
 203               	.L10:
 204 0264 202E FFFC 	move.l -4(%fp),%d0
 205 0268 4E5E      	unlk %fp
 206 026a 4E75      	rts
 208               	.align2
 209               	.globldisk_read
 211               	disk_read:
 212 026c 4E56 FFF4 	link.w %fp,#-12
 213 0270 202E 0008 	move.l 8(%fp),%d0
 214 0274 1D40 FFF6 	move.b %d0,-10(%fp)
 215 0278 102E FFF6 	move.b -10(%fp),%d0
 216 027c 5200      	addq.b #1,%d0
 217 027e 1000      	move.b %d0,%d0
 218 0280 0280 0000 	and.l #255,%d0
 218      00FF 
 219 0286 2F2E 000C 	move.l 12(%fp),-(%sp)
 220 028a 2F00      	move.l %d0,-(%sp)
 221 028c 2F2E 0014 	move.l 20(%fp),-(%sp)
 222 0290 2F2E 0010 	move.l 16(%fp),-(%sp)
 223 0294 4878 0001 	pea 1.w
 224 0298 4EB9 0000 	jsr _ide
 224      0000 
 225 029e 4FEF 0014 	lea (20,%sp),%sp
 226 02a2 2D40 FFFC 	move.l %d0,-4(%fp)
 227 02a6 42AE FFF8 	clr.l -8(%fp)
 228 02aa 202E FFFC 	move.l -4(%fp),%d0
 229 02ae 4E5E      	unlk %fp
 230 02b0 4E75      	rts
 232               	.align2
 233               	.globldisk_write
 235               	disk_write:
 236 02b2 4E56 FFF4 	link.w %fp,#-12
 237 02b6 202E 0008 	move.l 8(%fp),%d0
 238 02ba 1D40 FFF6 	move.b %d0,-10(%fp)
 239 02be 102E FFF6 	move.b -10(%fp),%d0
 240 02c2 5200      	addq.b #1,%d0
 241 02c4 1000      	move.b %d0,%d0
 242 02c6 0280 0000 	and.l #255,%d0
 242      00FF 
 243 02cc 2F2E 000C 	move.l 12(%fp),-(%sp)
 244 02d0 2F00      	move.l %d0,-(%sp)
 245 02d2 2F2E 0014 	move.l 20(%fp),-(%sp)
 246 02d6 2F2E 0010 	move.l 16(%fp),-(%sp)
 247 02da 4878 0002 	pea 2.w
 248 02de 4EB9 0000 	jsr _ide
 248      0000 
 249 02e4 4FEF 0014 	lea (20,%sp),%sp
 250 02e8 2D40 FFFC 	move.l %d0,-4(%fp)
 251 02ec 42AE FFF8 	clr.l -8(%fp)
 252 02f0 202E FFFC 	move.l -4(%fp),%d0
 253 02f4 4E5E      	unlk %fp
 254 02f6 4E75      	rts
 256               	.align2
 257               	.globldisk_ioctl
 259               	disk_ioctl:
68K GAS   			page 6


 260 02f8 4E56 FFF8 	link.w %fp,#-8
 261 02fc 222E 0008 	move.l 8(%fp),%d1
 262 0300 202E 000C 	move.l 12(%fp),%d0
 263 0304 1D41 FFFA 	move.b %d1,-6(%fp)
 264 0308 1D40 FFF8 	move.b %d0,-8(%fp)
 265 030c 7004      	moveq #4,%d0
 266 030e 2D40 FFFC 	move.l %d0,-4(%fp)
 267 0312 4280      	clr.l %d0
 268 0314 102E FFFA 	move.b -6(%fp),%d0
 269 0318 1030 0FB0 	move.b Stat(%d0.l*8),%d0
 269      0000 0000 
 270 0320 1000      	move.b %d0,%d0
 271 0322 0280 0000 	and.l #255,%d0
 271      00FF 
 272 0328 7201      	moveq #1,%d1
 273 032a C081      	and.l %d1,%d0
 274 032c 1000      	move.b %d0,%d0
 275 032e 4A00      	tst.b %d0
 276 0330 6704      	jeq .L15
 277 0332 7003      	moveq #3,%d0
 278 0334 6078      	jra .L16
 279               	.L15:
 280 0336 4280      	clr.l %d0
 281 0338 102E FFF8 	move.b -8(%fp),%d0
 282 033c 7204      	moveq #4,%d1
 283 033e B280      	cmp.l %d0,%d1
 284 0340 6568      	jcs .L17
 285 0342 303B 0A06 	move.w .L23(%pc,%d0.l*2),%d0
 286 0346 4EFB 0002 	jmp %pc@(2,%d0:w)
 287               	.balignw 2,0x284c
 288               	.L23:
 289 034a 000A      	.word .L18-.L23
 290 034c 0010      	.word .L19-.L23
 291 034e 002C      	.word .L20-.L23
 292 0350 0048      	.word .L21-.L23
 293 0352 005A      	.word .L22-.L23
 294               	.L18:
 295 0354 42AE FFFC 	clr.l -4(%fp)
 296 0358 6050      	jra .L17
 297               	.L19:
 298 035a 222E 0010 	move.l 16(%fp),%d1
 299 035e 4280      	clr.l %d0
 300 0360 102E FFFA 	move.b -6(%fp),%d0
 301 0364 2030 0FB0 	move.l Stat+4(%d0.l*8),%d0
 301      0000 0000 
 302 036c 2041      	move.l %d1,%a0
 303 036e 2080      	move.l %d0,(%a0)
 304 0370 42AE FFFC 	clr.l -4(%fp)
 305 0374 6034      	jra .L17
 306               	.L20:
 307 0376 222E 0010 	move.l 16(%fp),%d1
 308 037a 4280      	clr.l %d0
 309 037c 102E FFFA 	move.b -6(%fp),%d0
 310 0380 3030 0FB0 	move.w Stat+2(%d0.l*8),%d0
 310      0000 0000 
 311 0388 2041      	move.l %d1,%a0
 312 038a 3080      	move.w %d0,(%a0)
68K GAS   			page 7


 313 038c 42AE FFFC 	clr.l -4(%fp)
 314 0390 6018      	jra .L17
 315               	.L21:
 316 0392 202E 0010 	move.l 16(%fp),%d0
 317 0396 2040      	move.l %d0,%a0
 318 0398 20BC 0000 	move.l #128,(%a0)
 318      0080 
 319 039e 42AE FFFC 	clr.l -4(%fp)
 320 03a2 6006      	jra .L17
 321               	.L22:
 322 03a4 42AE FFFC 	clr.l -4(%fp)
 323 03a8 4E71      	nop
 324               	.L17:
 325 03aa 202E FFFC 	move.l -4(%fp),%d0
 326               	.L16:
 327 03ae 4E5E      	unlk %fp
 328 03b0 4E75      	rts
 330               	.ident"GCC: (GNU) 4.5.1"
 331               	.section.note.GNU-stack,"",@progbits
68K GAS   			page 8


DEFINED SYMBOLS
                            *ABS*:00000000 diskio.c
    {standard input}:8      .bss:00000000 usNumHeads
    {standard input}:14     .bss:00000002 usNumSecs
    {standard input}:17     .bss:00000004 Stat
    {standard input}:17     .bss:00000054 Buffer
    {standard input}:21     .bss:00000254 stat
    {standard input}:26     .text:00000000 init_ff
    {standard input}:44     .text:00000036 disk_initialize
    {standard input}:104    .text:00000106 disk_status
    {standard input}:118    .text:0000012a disk_readp
    {standard input}:154    .text:0000019c disk_writep
    {standard input}:211    .text:0000026c disk_read
    {standard input}:235    .text:000002b2 disk_write
    {standard input}:259    .text:000002f8 disk_ioctl

UNDEFINED SYMBOLS
memset
idetifyIDE
_ide
memcpy
